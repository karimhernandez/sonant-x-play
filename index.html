<html>

<head>
  <title>Sonant-X Player</title>
  <style type="text/css">
/*! minireset.css v0.0.6 | MIT License | github.com/jgthms/minireset.css */html,body,p,ol,ul,li,dl,dt,dd,blockquote,figure,fieldset,legend,textarea,pre,iframe,hr,h1,h2,h3,h4,h5,h6{margin:0;padding:0}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:normal}ul{list-style:none}button,input,select,textarea{margin:0}html{box-sizing:border-box}*,*::before,*::after{box-sizing:inherit}img,video{height:auto;max-width:100%}iframe{border:0}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}td:not([align]),th:not([align]){text-align:left}body{font-family:arial,sans-serif;background:#0e0e0e;color:#fff;margin:0;overflow:hidden}.container{position:absolute;top:50%;left:50%;margin-right:-50%;transform:translate(-50%,-50%)}h1{font-size:20px;font-weight:bold;margin:0 0 10px 1px}h1 a{color:#fff;text-decoration:none}.controls{height:35px;display:flex;align-items:center;justify-content:space-between;color:#9d9d9d;background-color:#262626;border:#202020 1px solid;border-top-color:#313131;border-left-color:#313131;padding:0 10px}.controls p{font-size:12px;text-shadow:1px 1px #000}.controls .button{display:inline-block;background-color:#3e3e3e;background-image:linear-gradient(to bottom,#646464 0,#3e3e3e 50%,#1f1f1f 100%);border:#161616 1px solid;border-radius:3px;width:50px;height:30px;vertical-align:middle;text-align:center;direction:ltr}.controls .button:focus{outline:0}.controls .button:active{background-image:none}.controls .button.play i::before{content:'';position:absolute;width:0;height:0;border-top:7px solid transparent;border-left:14px solid #9d9d9d;border-bottom:7px solid transparent;margin:-7px 0 0 -6px}.controls .button.stop i::before{content:'';position:absolute;width:14px;height:14px;border:0;border-left:14px solid #9d9d9d;margin:-7px 0 0 -7px}.controls .button:active i::before{border-left-color:#888}.controls .button.edit{width:51px}.controls .button.edit i{border:2px solid;width:31px;height:16px;margin:6px 1px 6px 1px;display:inline-block;position:relative;box-sizing:border-box;color:#9d9d9d}.controls .button.edit i::before{content:'';position:absolute;left:4px;top:0;width:1px;height:100%;box-shadow:-1px 0,3px 0,7px 0,11px 0,15px 0,19px 0}.controls .button.edit i::after{content:'';position:absolute;width:3px;height:7px;left:4px;top:0;box-shadow:inset 1px 0,inset -1px 0,-2px 0,2px 0,10px 0,14px 0,18px 0}.controls .button.edit:active i{color:#888}
  </style>
</head>

<body>
  <div class="container">
    <h1><a href="https://github.com/karimhernandez/sonant-x-play">Sonant-X Player</a></h1>
    <canvas id="canvas" width="400" height="100"></canvas>
    <div class="controls">
      <button id="play" class="button play"><i></i></button>
      <p id="message">loading</p>
      <p id="time">00:00</p>
      <a href="#" id="edit" class="button edit"><i></i></a>
    </div>
  </div>
  <script>
var n=function(){function n(n,e){if(!o[n]){o[n]={};for(var t=0;t<n.length;t++)o[n][n.charAt(t)]=t}return o[n][e]}var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={},u={compressToBase64:function(n){if(null==n)return"";var e=u.t(n,6,function(n){return t.charAt(n)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:u.o(e.length,32,function(r){return n(t,e.charAt(r))})},compressToUTF16:function(n){return null==n?"":u.t(n,15,function(n){return e(n+32)})+" "},decompressFromUTF16:function(n){return null==n?"":""==n?null:u.o(n.length,16384,function(e){return n.charCodeAt(e)-32})},compressToUint8Array:function(n){for(var e=u.compress(n),t=new Uint8Array(2*e.length),r=0,o=e.length;o>r;r++){var l=e.charCodeAt(r);t[2*r]=l>>>8,t[2*r+1]=l%256}return t},decompressFromUint8Array:function(n){if(null===n||void 0===n)return u.decompress(n);for(var t=new Array(n.length/2),r=0,o=t.length;o>r;r++)t[r]=256*n[2*r]+n[2*r+1];var l=[];return t.forEach(function(n){l.push(e(n))}),u.decompress(l.join(""))},compressToEncodedURIComponent:function(n){return null==n?"":u.t(n,6,function(n){return r.charAt(n)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),u.o(e.length,32,function(t){return n(r,e.charAt(t))}))},compress:function(n){return u.t(n,16,function(n){return e(n)})},t:function(n,e,t){if(null==n)return"";var r,o,u,l={},i={},c="",f="",a="",s=2,d=3,m=2,h=[],p=0,w=0;for(u=0;u<n.length;u+=1)if(c=n.charAt(u),Object.prototype.hasOwnProperty.call(l,c)||(l[c]=d++,i[c]=!0),f=a+c,Object.prototype.hasOwnProperty.call(l,f))a=f;else{if(Object.prototype.hasOwnProperty.call(i,a)){if(a.charCodeAt(0)<256){for(r=0;m>r;r++)p<<=1,w==e-1?(w=0,h.push(t(p)),p=0):w++;for(o=a.charCodeAt(0),r=0;8>r;r++)p=p<<1|1&o,w==e-1?(w=0,h.push(t(p)),p=0):w++,o>>=1}else{for(o=1,r=0;m>r;r++)p=p<<1|o,w==e-1?(w=0,h.push(t(p)),p=0):w++,o=0;for(o=a.charCodeAt(0),r=0;16>r;r++)p=p<<1|1&o,w==e-1?(w=0,h.push(t(p)),p=0):w++,o>>=1}0==--s&&(s=Math.pow(2,m),m++),delete i[a]}else for(o=l[a],r=0;m>r;r++)p=p<<1|1&o,w==e-1?(w=0,h.push(t(p)),p=0):w++,o>>=1;0==--s&&(s=Math.pow(2,m),m++),l[f]=d++,a=String(c)}if(""!==a){if(Object.prototype.hasOwnProperty.call(i,a)){if(a.charCodeAt(0)<256){for(r=0;m>r;r++)p<<=1,w==e-1?(w=0,h.push(t(p)),p=0):w++;for(o=a.charCodeAt(0),r=0;8>r;r++)p=p<<1|1&o,w==e-1?(w=0,h.push(t(p)),p=0):w++,o>>=1}else{for(o=1,r=0;m>r;r++)p=p<<1|o,w==e-1?(w=0,h.push(t(p)),p=0):w++,o=0;for(o=a.charCodeAt(0),r=0;16>r;r++)p=p<<1|1&o,w==e-1?(w=0,h.push(t(p)),p=0):w++,o>>=1}0==--s&&(s=Math.pow(2,m),m++),delete i[a]}else for(o=l[a],r=0;m>r;r++)p=p<<1|1&o,w==e-1?(w=0,h.push(t(p)),p=0):w++,o>>=1;0==--s&&(s=Math.pow(2,m),m++)}for(o=2,r=0;m>r;r++)p=p<<1|1&o,w==e-1?(w=0,h.push(t(p)),p=0):w++,o>>=1;for(;;){if(p<<=1,w==e-1){h.push(t(p));break}w++}return h.join("")},decompress:function(n){return null==n?"":""==n?null:u.o(n.length,32768,function(e){return n.charCodeAt(e)})},o:function(n,t,r){var o,u,l,i,c,f,a,s=[],d=4,m=4,h=3,p="",w=[],v={val:r(0),position:t,index:1};for(o=0;3>o;o+=1)s[o]=o;for(l=0,c=Math.pow(2,2),f=1;f!=c;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=r(v.index++)),l|=(i>0?1:0)*f,f<<=1;switch(l){case 0:for(l=0,c=Math.pow(2,8),f=1;f!=c;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=r(v.index++)),l|=(i>0?1:0)*f,f<<=1;a=e(l);break;case 1:for(l=0,c=Math.pow(2,16),f=1;f!=c;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=r(v.index++)),l|=(i>0?1:0)*f,f<<=1;a=e(l);break;case 2:return""}for(s[3]=a,u=a,w.push(a);;){if(v.index>n)return"";for(l=0,c=Math.pow(2,h),f=1;f!=c;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=r(v.index++)),l|=(i>0?1:0)*f,f<<=1;switch(a=l){case 0:for(l=0,c=Math.pow(2,8),f=1;f!=c;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=r(v.index++)),l|=(i>0?1:0)*f,f<<=1;s[m++]=e(l),a=m-1,d--;break;case 1:for(l=0,c=Math.pow(2,16),f=1;f!=c;)i=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=r(v.index++)),l|=(i>0?1:0)*f,f<<=1;s[m++]=e(l),a=m-1,d--;break;case 2:return w.join("")}if(0==d&&(d=Math.pow(2,h),h++),s[a])p=s[a];else{if(a!==m)return null;p=u+u.charAt(0)}w.push(p),s[m++]=u+p.charAt(0),u=p,0==--d&&(d=Math.pow(2,h),h++)}}};return u}();"function"==typeof define&&define.amd?define(function(){return n}):"undefined"!=typeof module&&null!=module&&(module.exports=n);let e,t=44100,r=0,o=4096,u=o-1,l=new Float32Array(4*o);for(let n=0;n<o;n++)l[n]=Math.sin(6.283184*n/o),l[n+o]=l[n]<0?-1:1,l[n+2*o]=n/o-.5,l[n+3*o]=n<o/2?n/(o/4)-1:3-n/(o/4);function i(n,e,t,r,o){let u=r.fx_delay_time*o>>1,l=r.fx_delay_amt/255,i=0;for(;i<t-u;){let t=i,r=i+u;n[r]+=e[t]*l,e[r]+=n[t]*l,i++}}function c(n){return.00390625*Math.pow(1.059463094,n-128)}function f(n,e,i,f,a,s){let d=n.lfo_waveform*o,m=n.osc1_waveform*o,h=n.osc2_waveform*o,p=n.env_attack,w=n.env_sustain,v=n.env_release,b=Math.pow(2,n.fx_pan_freq-8)/e,M=Math.pow(2,n.lfo_freq-8)/e,y=0,g=0,F=c(i+12*(n.osc1_oct-8)+n.osc1_det)*(1+8e-4*n.osc1_detune),A=c(i+12*(n.osc2_oct-8)+n.osc2_det)*(1+8e-4*n.osc2_detune);r++;let $=n.fx_resonance/255,k=0,U=0,O=f.length;for(let e=p+w+v-1;e>=0;--e){let r=e+s,i=l[(r*M*o&u)+d]*n.lfo_amt/512+.5,c=1;e<p?c=e/p:e>=p+w&&(c-=(e-p-w)/v);let T=F;n.lfo_osc1_freq&&(T+=i),n.osc1_xenv&&(T*=c*c);let I=l[((y+=T)*o&u)+m]*n.osc1_vol;T=A,n.osc2_xenv&&(T*=c*c),I+=l[((g+=T)*o&u)+h]*n.osc2_vol,n.noise_fader&&(I+=(2*Math.random()-1)*n.noise_fader*c),I*=c/255;let R=n.fx_freq;n.lfo_fx_freq&&(R*=i);let S=$*(I-U)-(k+=(R=1.5*l[.5*R/t*o&u])*U);switch(U+=R*S,n.fx_filter){case 1:I=S;break;case 2:I=k;break;case 3:I=U;break;case 4:I=k+S}T=l[r*b*o&u]*n.fx_pan_amt/512+.5,I*=.00476*n.env_master,r<O&&(f[r]+=I*(1-T),a[r]+=I*T)}}function a(n){let e=t*n.songLen,r=new Float32Array(e),o=new Float32Array(e);for(let t=0;t<n.songData.length;t++){let u=n.songData[t],l=new Float32Array(e),c=new Float32Array(e),a=0,s=0,d=0;for(;;){if(32==d){d=0,s+=1;continue}if(s==n.endPattern-1){i(l,c,e,u,n.rowLen);for(let n=0;n<e;n++)r[n]+=l[n],o[n]+=c[n];break}let t=u.p[s];if(t){let e=u.c[t-1].n[d];e&&f(u,n.rowLen,e,l,c,a)}a+=n.rowLen,d++}}return m(r,o)}function s(n,e){let t=n.env_attack+n.env_sustain+n.env_release-1+179360,r=new Float32Array(t),o=new Float32Array(t);return f(n,5605,e,r,o,0),i(r,o,t,n,5605),m(r,o)}function d(){return(e=new(window.webkitAudioContext||window.AudioContext)).resume(),e}function m(n,r){let o=e.createBuffer(2,n.length,t);return o.getChannelData(0).set(n),o.getChannelData(1).set(r),o}function h(n,t){let r=e.createBufferSource();r.buffer=n,r.loop=t,r.connect(e.destination),r.start()}!async function(){let e=null,t=null,r=null,o=null,u=null;const l="https://nicolas-van.github.io/sonant-x-live/";let i=null,c=null,f=null,s=null,m=null,h=1,p=[],w=!1;function v(n){n&&n.length>0&&(r.innerText=n)}function b(n){n&&n.length>0&&(o.innerText=n)}function M(){U(),k()}function y(){w?U():function(){if(w)return;if(!c)return;(i=d()).resume(),(m=i.createAnalyser()).minDecibels=-90,m.maxDecibels=-10,m.smoothingTimeConstant=.86,(s=i.createBufferSource()).buffer=f,s.connect(m),m.connect(i.destination),s.start(0),w=!0,t.className="button stop"}()}function g(n){n.preventDefault()}function F(e){if(e.preventDefault(),e.dataTransfer.files&&e.dataTransfer.files.length>0){let e=new FileReader;e.onloadend=function(){let e=JSON.parse(this.result);e&&e.songLen>0&&e.songData.length>0?function(e){let t=function(n){return escape(n)},r=JSON.stringify(e),o=(u=n.compressToBase64(r),encodeURIComponent(u).replace(/[!'()*]/g,t).replace(/\*/g,"%2A"));var u;location.hash="#"+o}(e):v("drop failed.")},e.readAsText(event.dataTransfer.files[0])}}function A(n,e){return(n=n.toString()).length<e?A("0"+n,e):n}function $(n){n=Number(n);let e=Math.floor(n%3600/60),t=Math.floor(n%60);return(e>=0?A(e,2):"")+":"+(t>=0?A(t,2):"")}function k(){v("Loading song..."),b(`${$(0)}`),setTimeout(function(){if(!(c=function(){let e=null,t=null,r=null;return(e=location.hash.length?location.hash.substring(1):"")&&(t=n.decompressFromBase64(decodeURIComponent(e))),t&&(r=JSON.parse(t)),r}()))return v("no song"),void b(`${$(0)}`);u.href=l+location.hash;let e=new Date;f=a(c),v(`Generation time: ${new Date-e}ms`),b(`${$(0)} / ${$(c.songLen)}`),m.fftSize=256,h=m.frequencyBinCount,p=new Uint8Array(h)},16)}function U(){w&&(s.stop(),i.close()),w=!1,c&&c.songLen?b(`${$(0)} / ${$(c.songLen)}`):b(`${$(0)}`),t.className="button play"}!function(){e=document.getElementById("canvas"),t=document.getElementById("play"),r=document.getElementById("message"),o=document.getElementById("time"),u=document.getElementById("edit"),t.addEventListener("click",y),window.addEventListener("hashchange",M),document.body.ondragover=g,document.body.ondrop=F,i=d(),(m=i.createAnalyser()).minDecibels=-90,m.maxDecibels=-10,m.smoothingTimeConstant=.86;let n=canvas.getContext("2d"),l=canvas.width,a=canvas.height;n.clearRect(0,0,l,a),n.fillStyle="rgb(58,58,58)",n.fillRect(0,0,l,a),k(),setInterval(function(){if(w&&(b(`${$(i.currentTime)} / ${$(c.songLen)}`),i.currentTime>f.duration&&U()),n.fillStyle="rgb(58,58,58)",n.fillRect(0,0,l,a),!w)return;m.getByteFrequencyData(p);let e,t=l/h,r=0,o=0;for(let u=0;u<h;u++)o=(e=p[u])+100,n.fillStyle=`rgb(${o},${o},${o})`,n.fillRect(r,a-e/2,t,e/2),r+=t+1},16)}()}();  </script>
</body>

</html>